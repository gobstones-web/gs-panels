<link rel="import" href="gs-events.html">
<dom-module id="gs-rezisable">
  <template>
    <style>
      
    </style>


  </template>
  <script>
    if (typeof window.GS === 'undefined') {
      window.GS = {};
    }

    GS.Rezisable = {
      properties: {
        parentOrientation: {
          type: String
        },
        notLast: {
          type: Boolean,
          observer: '_not_last_change'
        }
      },
      listeners: (function() {
        var listeners;
        listeners = {};
        listeners[GS.EVENTS.RESIZE_BEGIN] = '__on_begin_resize';
        return listeners;
      })(),
      HORIZONTAL: 'horizontal',
      VERTICAL: 'vertical',
      NOT_LAST_CLASS: 'not-last',
      molt: function(elem) {
        return window.getComputedStyle(elem);
      },
      parse_px: function(in_px) {
        var value;
        if (/px$/.test(in_px)) {
          value = parseFloat(in_px.slice(0, -2));
        } else {
          console.log('Error in px parsing. Receives: ' + in_px);
          value = in_px;
        }
        return value;
      },
      parse_percent: function(in_percent) {
        var value;
        if (/\%$/.test(in_percent)) {
          value = parseFloat(in_percent.slice(0, -1));
        } else {
          console.log('Error in % parsing. Receives: ' + in_percent);
          value = in_percent;
        }
        return value;
      },
      _not_last_change: function() {
        if (this.notLast) {
          return this.classList.add(this.NOT_LAST_CLASS);
        } else {
          return this.classList.remove(this.NOT_LAST_CLASS);
        }
      },
      ready: function() {
        this.parentOrientation = this.parentOrientation || this.HORIZONTAL;
        return this.classList.add('child-of-' + this.parentOrientation);
      },
      __on_begin_resize: function(evnt) {
        var context, mousemove, mouseup;
        evnt.cancelBubble = true;
        evnt.preventDefault();
        context = {
          item: this
        };
        mousemove = (function(_this) {
          return function(evnt) {
            evnt.cancelBubble = true;
            evnt.preventDefault();
            return _this.resize(context, evnt);
          };
        })(this);
        mouseup = (function(_this) {
          return function(evnt) {
            if (evnt.which !== 1) {
              return;
            }
            evnt.cancelBubble = true;
            evnt.preventDefault();
            _this.finish_resize(context, evnt);
            document.removeEventListener("mousemove", mousemove);
            return document.removeEventListener("mouseup", mouseup);
          };
        })(this);
        document.addEventListener("mouseup", mouseup);
        document.addEventListener("mousemove", mousemove);
        return this.begin_resize(context, evnt);
      },
      begin_resize: function(context, native_event) {
        return this.fire(GS.EVENTS.CHILD_RESIZE_BEGIN, {
          context: context,
          position: {
            clientX: native_event.detail.clientX,
            clientY: native_event.detail.clientY
          }
        });
      },
      resize: function(context, polymer_event) {
        return this.fire(GS.EVENTS.CHILD_RESIZE, {
          context: context,
          position: {
            clientX: polymer_event.clientX,
            clientY: polymer_event.clientY
          }
        });
      },
      finish_resize: function(context, polymer_event) {
        return this.fire(GS.EVENTS.CHILD_RESIZE_FINISH, {
          context: context,
          position: {
            clientX: polymer_event.clientX,
            clientY: polymer_event.clientY
          }
        });
      }
    };

  </script>
</dom-module>